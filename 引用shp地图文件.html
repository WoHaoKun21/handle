<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>shp引用XML地图文件</title>
    <link rel="stylesheet" href="./leaflets/leaflet.css" />
    <script src="./leaflets/leaflet.js"></script>
    <script src="./js/shp.min.js"></script>
    <style>
      * {
        padding: 0;
        margin: 0;
        list-style: none;
      }
      .container {
        width: 100vw;
        height: 100vh;
      }
      #map {
        width: 100%;
        height: 100%;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div id="map"></div>
    </div>
  </body>

  <script>
    // 初始化天地图
    const map = L.map("map", {
      center: [29.516916, 106.522858],
      zoom: 16,
      crs: L.CRS.EPSG4326,
    });

    // 天地图影像图
    L.tileLayer(
      `http://t{s}.tianditu.com/img_c/wmts?layer=img&style=default&tilematrixset=c&Service=WMTS&Request=GetTile&Version=1.0.0&Format=tiles&TileMatrix={z}&TileCol={x}&TileRow={y}&tk=e0f2f9897bc755f61438b03804066a32`,
      {
        maxZoom: 17,
        tileSize: 256,
        zoomOffset: 1,
        minZoom: 3,
        subdomains: ["0", "1", "2", "3", "4", "5", "6", "7"],
      }
    ).addTo(map);
    // 天地图影像注记
    L.tileLayer(
      `http://t{s}.tianditu.com/cia_c/wmts?layer=cia&style=default&tilematrixset=c&Service=WMTS&Request=GetTile&Version=1.0.0&Format=tiles&TileMatrix={z}&TileCol={x}&TileRow={y}&tk=e0f2f9897bc755f61438b03804066a32`,
      {
        maxZoom: 17,
        tileSize: 256,
        zoomOffset: 1,
        zIndex: 5,
        minZoom: 3,
        subdomains: ["0", "1", "2", "3", "4", "5", "6", "7"],
      }
    ).addTo(map);

    // map.addLayer(overlaysImg);
    shp("./docs/myshape.zip")
      .then((geojson) => {
        console.log("GeoJSON 加载成功:", geojson);
        const layer = L.geoJSON(geojson, {
          style: { color: "red", weight: 1 },
        }).addTo(map);
        map.fitBounds(layer.getBounds());
      })
      .catch((err) => {
        console.error("加载 shapefile 出错:", err);
        alert("加载 shapefile 出错，请查看控制台");
      });
  </script>
</html>
