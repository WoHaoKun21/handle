<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>shp引用XML地图文件</title>
    <link rel="stylesheet" href="./leaflets/leaflet.css" />
    <script src="./leaflets/leaflet.js"></script>
    <script src="./js/shpFile.js"></script>
    <style>
      * {
        padding: 0;
        margin: 0;
        list-style: none;
      }

      .container {
        width: 100vw;
        height: 100vh;
      }

      #map {
        width: 100%;
        height: 100%;
      }
    </style>
  </head>

  <body>
    <div class="container">
      <div id="map"></div>
    </div>
  </body>

  <script>
    // 初始化天地图
    const map = L.map("map", {
      center: [29.516916, 106.522858],
      zoom: 16,
      crs: L.CRS.EPSG4326,
    });

    // 天地图影像图
    L.tileLayer(
      `http://t{s}.tianditu.com/img_c/wmts?layer=img&style=default&tilematrixset=c&Service=WMTS&Request=GetTile&Version=1.0.0&Format=tiles&TileMatrix={z}&TileCol={x}&TileRow={y}&tk=e0f2f9897bc755f61438b03804066a32`,
      {
        maxZoom: 17,
        tileSize: 256,
        zoomOffset: 1,
        minZoom: 3,
        subdomains: ["0", "1", "2", "3", "4", "5", "6", "7"],
      }
    ).addTo(map);
    // 天地图影像注记
    L.tileLayer(
      `http://t{s}.tianditu.com/cia_c/wmts?layer=cia&style=default&tilematrixset=c&Service=WMTS&Request=GetTile&Version=1.0.0&Format=tiles&TileMatrix={z}&TileCol={x}&TileRow={y}&tk=e0f2f9897bc755f61438b03804066a32`,
      {
        maxZoom: 17,
        tileSize: 256,
        zoomOffset: 1,
        zIndex: 5,
        minZoom: 3,
        subdomains: ["0", "1", "2", "3", "4", "5", "6", "7"],
      }
    ).addTo(map);

    // https://106.12.220.248:39562/down/kLLqeP92qTsX.dbf
    // https://106.12.220.248:39562/down/M0MU29Gg8oP2.prj
    // https://106.12.220.248:39562/down/sBVc2W63JVT3.sbn
    // https://106.12.220.248:39562/down/bsysor85wLUI.sbx
    // https://106.12.220.248:39562/down/Zb5hVbUncx9R.shp
    // https://106.12.220.248:39562/down/QJDLNQhIrKFV.xml
    // https://106.12.220.248:39562/down/CMl3ovyuYXSI.shx

    shapefile
      .open("https://106.12.220.248:39562/down/Zb5hVbUncx9R.shp")
      .then((source) => {
        source.read().then(function log(result) {
          if (result.done) return;
          console.log("数据：", result.value);

          // const layer = L.geoJSON(result.value, {
          //   style: { color: "red", weight: 1 },
          // }).addTo(map);
          // map.fitBounds(layer.getBounds());
          // return source.read().then(log);
        });
      })
      .catch((error) => console.error(error.stack));
  </script>
</html>
